package com.rubu.ui.act;

import android.content.Intent;
import android.util.Log;
import android.view.View;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.rubu.R;
import com.rubu.base.BaseActivity;
import com.rubu.constant.Constant;
import com.rubu.model.Base;
import com.rubu.model.InfoModel;
import com.rubu.net.ApiImp;
import com.rubu.net.Params;
import com.rubu.net.ReqJson;
import com.rubu.util.SPUtils;
import com.rubu.util.StringUtil;

import java.io.UnsupportedEncodingException;

import butterknife.BindView;
import butterknife.OnClick;
import rx.Observer;
import rx.android.schedulers.AndroidSchedulers;
import rx.schedulers.Schedulers;

/**
 * Email 727320580@qq.com
 * Created by xika on 2017/5/4
 * Vwesion 1.0
 * Dsscription:  设置银行卡号
 */

public class SetBankCodeAvt extends BaseActivity {

    @BindView(R.id.title_left)
    TextView titleLeft;
    @BindView(R.id.title)
    TextView title;
    @BindView(R.id.userName)
    TextView mUserName;
    @BindView(R.id.bank_code)
    EditText mBankCode;
    private InfoModel.RowsBean rowsBean;
    private String banKCode;

    @Override
    protected int getViewId() {
        return R.layout.activity_set_bank_code;
    }

    @Override
    protected void initEvent() {
        rowsBean = (InfoModel.RowsBean) getIntent().getSerializableExtra("rowsBean");
        mUserName.setText(rowsBean.getS_user_name());
        title.setText("个人信息");
        titleLeft.setText("返回");
        titleLeft.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                onBackPressed();
            }
        });
    }

    @OnClick({R.id.btn_complete})
    public void onClick(View view) {
        switch (view.getId()) {
            case R.id.btn_complete:
                banKCode = mBankCode.getText().toString().trim();
                char[] asC = banKCode.toCharArray();
                int a = asC.length;
                if (a == 19 || a == 16) {
                    setBankCode();
                } else {
                    Toast.makeText(mContext, "请重新核对卡号", Toast.LENGTH_LONG).show();
                }
                break;
        }
    }

    /**
     * 请求修改密码接口
     */
    private void setBankCode() {
        ReqJson json = new ReqJson();
        if (rowsBean != null) {
            json.setS_user_account(mBankCode.getText().toString());
            json.setProc(Constant.PROC_APP_WORKER_BRANK_MSG);
            json.setS_user_id(rowsBean.getS_user_id() + "");
            json.setHas_rows("no");
            mSubscription = ApiImp.get().setBankCode(Params.getNetWorkParams(json)).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(new Observer<Base>() {
                @Override
                public void onCompleted() {

                }

                @Override
                public void onError(Throwable e) {
                    showToast("网络不给力");
                }

                @Override
                public void onNext(Base base) {
                    if (base.getResult().getOut_Flag() == 0) {
                        showToast(base.getResult().getOut_nszRtn());
                        Intent intent = new Intent(mContext, UserInfoAct.class);
                        intent.putExtra("bankCode", banKCode);
                        setResult(RESULT_OK, intent);
                        finish();
                    }
                }
            });
        } else {
            showToast("请稍候再试");
        }
    }

}
